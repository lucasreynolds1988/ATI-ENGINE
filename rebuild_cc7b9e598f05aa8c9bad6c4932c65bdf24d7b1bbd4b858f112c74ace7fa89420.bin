# ~/Soap/system_status_dashboard.py

import os
import time
from pathlib import Path

def check_process(keyword):
    try:
        result = os.popen(f"ps aux | grep '{keyword}' | grep -v grep").read()
        return "âœ… RUNNING" if result else "âŒ OFFLINE"
    except:
        return "âŒ ERROR"

def check_dir(path, min_files=1):
    p = Path(path).expanduser()
    if not p.exists():
        return "âŒ MISSING"
    count = len(list(p.glob("*")))
    return f"âœ… {count} files" if count >= min_files else "âš ï¸ Low files"

def pulse_bar():
    bars = ["â–","â–ƒ","â–„","â–…","â–†","â–‡","â–ˆ","â–‡","â–†","â–…","â–„","â–ƒ","â–"]
    for b in bars:
        yield b

def display():
    print("\033c", end="")  # Clear screen
    print("ğŸ§  ATI SYSTEM STATUS MONITOR\n")
    print("ğŸ” Rotor Engine     :", check_process("rotor_fusion"))
    print("ğŸ§© Watson Agent     :", check_process("watson_phase"))
    print("ğŸ” Arbiter Logic    :", check_process("arbiter_knowledge"))
    print("ğŸ§  Soap Engine      :", check_process("soap_complete"))
    print("ğŸ•·ï¸  Web Scraper     :", check_process("web_scraper_agent"))
    print("â˜ï¸ MongoDB Status   :", check_dir("~/Soap/data/mongo_chunks", 2))
    print("ğŸ“‚ GCS Sync Check   :", check_dir("~/Soap_overlay", 2))
    print("ğŸ“œ Harvested HTML   :", check_dir("~/Soap/data/web_scrape", 10))
    print("ğŸ“„ SOP Queue        :", check_dir("~/Soap/agent_queue", 1))
    print("ğŸ§¾ Relay Log File   :", check_dir("~/Soap/data/logs/relay_log.json", 1))
    print("ğŸ”„ Pulse: ", next(pulser))

if __name__ == "__main__":
    pulser = pulse_bar()
    try:
        while True:
            display()
            time.sleep(4)
    except KeyboardInterrupt:
        print("\nğŸ›‘ Exiting System Monitor.")

